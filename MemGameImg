import tkinter as tk
from random import randint
from random import shuffle
import time

class Controller(tk.Tk):
    def __init__(self, *args, **kwargs):
        tk.Tk.__init__(self, *args, **kwargs)

        # the container is where we'll stack a bunch of frames
        # on top of each other, then the one we want visible
        # will be raised above the others
        container = tk.Frame(self)
        container.pack(side="top", fill="both", expand=True)
        container.grid_rowconfigure(0, weight=1)
        container.grid_columnconfigure(0, weight=1)

        if True:
            self.frames = {}
            for F in (PageMG,):
                page_name = F.__name__
                frame = F(parent=container, controller=self)
                self.frames[page_name] = frame

                # put all of the pages in the same location;
                # the one on the top of the stacking order
                # will be the one that is visible.
                frame.grid(row=0, column=0, sticky="nsew")

            self.show_frame("PageMG")
        self.geometry("500x400")

    def show_frame(self, page_name):
        '''Show a frame for the given page name'''
        frame = self.frames[page_name]
        frame.tkraise()


class PageMG(tk.Frame):
    def __init__(self, parent, controller):
        tk.Frame.__init__(self, parent)
        x = MemGame(self)
        x.pack()


class Tile(object):
    def __init__(self, canvas, x, y, image):
        self.canvas = canvas
        self.y = y
        self.x = x
        self.image = image

    def drawFaceDown(self):
        self.canvas.create_rectangle(self.x, self.y, self.x + 70, self.y + 70, fill = "blue")
        self.isFaceUp = False

    def drawFaceUp(self):
        self.canvas.create_rectangle(self.x, self.y, self.x + 70, self.y + 70, fill = "white")
        self.canvas.create_image(self.x + 35, self.y + 35, image = self.image)
        self.isFaceUp = True

    def isUnderMouse(self, event):
        if(event.x > self.x and event.x < self.x + 70):
            if(event.y > self.y and event.y < self.y + 70):
                return True


class MemGame(tk.Frame):
    def __init__(self, master):
        super(MemGame, self).__init__(master)

        photoRestart = tk.PhotoImage(file="restart.png")
        imgRestart = tk.Label(self, anchor="s", image=photoRestart)
        imgRestart.image = photoRestart
        buttonRestart = tk.Button(self, activebackground="white",
                                  image=photoRestart, highlightthickness=0, borderwidth=0,
                                  command=lambda: self.restart())
        buttonRestart.place(x=175, y=325)

        photoDog = tk.PhotoImage(file="Dyr/dog.png")
        photoElefant = tk.PhotoImage(file="Dyr/elefant.png")
        photoFlamingo = tk.PhotoImage(file="Dyr/flamingo.png")
        photoFlodhest = tk.PhotoImage(file="Dyr/flodhest.png")
        photoKamel = tk.PhotoImage(file="Dyr/kamel.png")
        photoKatt = tk.PhotoImage(file="Dyr/katt.png")
        photoKroko = tk.PhotoImage(file="Dyr/kroko.png")
        photoNeshorn = tk.PhotoImage(file="Dyr/neshorn.png")
        photoSkilpadde = tk.PhotoImage(file="Dyr/skilpadde.png")
        photoStruts = tk.PhotoImage(file="Dyr/struts.png")
        photoZebra = tk.PhotoImage(file="Dyr/zebra.png")
        photoLove = tk.PhotoImage(file="Dyr/love.png")

        #imgReturn = tk.Label(self, anchor="s", image=photoReturn)
        #imgReturn.image = photoReturn

        self.configure(width=400, height=380, bg="white")
        self.canvas = tk.Canvas(self, bg="white", width=400, height=350, highlightthickness=0, borderwidth=0)
        self.canvas.place(x=0, y=-30)
        self.tiles = []
        self.colors = [
            photoDog,
            photoElefant,
            photoFlamingo,
            photoFlodhest,
            photoKamel,
            photoKatt,
            photoKroko,
            photoNeshorn,
            photoSkilpadde,
            photoStruts,
            photoZebra,
            photoLove
        ]

        selected = []
        for i in range(10):
            randomInd = randint(0, len(self.colors) - 1)
            color = self.colors[randomInd]
            selected.append(color)
            selected.append(color)
            del self.colors[randomInd]
        shuffle(selected)
        self.flippedTiles = []
        NUM_COLS = 5
        NUM_ROWS = 4

        for x in range(0, NUM_COLS):
            for y in range(0, NUM_ROWS):
                self.tiles.append(Tile(self.canvas, x * 78 + 10, y * 78 + 40, selected.pop()))

        for i in range(len(self.tiles)):
            self.tiles[i].drawFaceDown()
        self.flippedThisTurn = 0
        self.canvas.bind("<Button-1>", self.mouseClicked)

    def mouseClicked(self, event):
        for tile in self.tiles:
            if tile.isUnderMouse(event) and (self.flippedThisTurn < 2):
                if (not(tile.isFaceUp)):
                    tile.drawFaceUp()
                    self.flippedTiles.append(tile)
                    self.flippedThisTurn += 1

                if (self.flippedThisTurn == 2):
                    self.after(1000, self.checkTiles)

    def checkTiles(self):
        self.flippedThisTurn = 0

        if not(self.flippedTiles[-1].image == self.flippedTiles[-2].image): #check last two elements
            self.flippedTiles[-1].drawFaceDown()
            self.flippedTiles[-2].drawFaceDown()
            del self.flippedTiles[-2:]

    def restart(self):
        for i in range(len(self.tiles)):
            self.tiles[i].drawFaceDown()


if __name__ == '__main__':
    c = Controller()
    c.mainloop()
